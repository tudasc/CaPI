#!/bin/bash
#
# Generates new Groundtruthes
#
source ./testfunctions
#Command option
if [ "$#" -ne 1 ]; then
    echo "Invalid input argument!"
    echo "Usage: runTestCases -tc=path/to/testcase -mcg=path/to/MCGfile"
    exit 1
fi

for arg in "$@" ; do
    case $arg in
        -tc=*)
            echo "$arg"
            if [ -d "${arg#*=}" ]; then
                tc="${arg#*=}"
            else
                echo "Invalid argument!"
                echo "Usage: runTestCase -tc=path/to/testcase -mcg=path/to/MCGfile"
                exit 1
            fi
            shift   
            ;;
        *)
            echo "Invalid option."          
            echo "Usage: runTestCase -tc=path/to/testcase -mcg=path/to/MCGfile"
            exit 1
            ;;
    esac
done

builddir=@CAPI_BIN_DIR@
capi=$builddir/lib/selection/capi


testcases=$tc/*.capi
for dir in $(find $tc -type d); do
    testcases=${dir}/*.capi
    for testcase in ${testcases}; do
        mcgs=${dir}/*.mcg
        for mcg in ${mcgs}; do
            if [[ $mcgs != $mcg ]]; then 
                currentmcg=$mcg
            fi
            if [[ "$testcase" == "$testcases" ]]; then
                break
            fi
            gtFile=$(generateOutputFilename $testcase $mcg)
            gtFile=${gtFile/.json/.gtjson}
	    echo "Generating new groundtruth for $testcase with $mcg"
    	    $capi -f $testcase --output-format json -o $gtFile $mcg
        done
        currentmcg=0
    done
done
