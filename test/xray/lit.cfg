import os
import lit.util
import lit.formats

# From libcxx lit: Tell pylint that we know config and lit_config exist somewhere.
if 'PYLINT_IMPORT' in os.environ:
    config = object()
    lit_config = object()

config.name = "CaPI_XRay_Test"

loaded_site_cfg = getattr(config, 'loaded_site_config', False)
if not loaded_site_cfg:
  # Check for 'site_config' user parameter, and use that if available.
  site_cfg = lit_config.params.get('site_config', None)
  if site_cfg and os.path.exists(site_cfg):
    lit_config.load_config(config, site_cfg)
    raise SystemExit

config.test_format = lit.formats.ShTest(execute_external=True)
config.suffixes = ['.c','.cpp', '.llin']
config.excludes = ['scorep_init.c']

capi_scorep_support = getattr(config, 'capi_scorep_support', None)
capi_lib_dir = getattr(config, 'capi_lib_dir', None)
capi_dyncapi_lib = 'dyncapi'
capi_dyncapi_scorep_lib = 'dyncapi_scorep'


config.substitutions.append(('%lib_dir', capi_lib_dir))
config.substitutions.append(('%dyncapi_lib', capi_dyncapi_lib))

if capi_scorep_support:
    config.substitutions.append(('%dyncapi_scorep_lib', capi_dyncapi_scorep_lib))
else:
  config.excludes.append('scorep')

