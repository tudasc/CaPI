function(configure_lit_site_cfg input output)
  # This function provides an automatic way to 'configure'-like generate a file
  # based on a set of common and custom variables, specifically targeting the
  # variables needed for the 'lit.site.cfg' files. This function bundles the
  # common variables that any Lit instance is likely to need, and custom
  # variables can be passed in.

  set(CAPI_PROJECT_DIR ${PROJECT_SOURCE_DIR})
  set(CAPI_LIB_DIR ${CMAKE_BINARY_DIR}/lib/)

  if (SCOREP_SUPPORT)
    set(CAPI_SCOREP_SUPPORT True)
  else()
    set(CAPI_SCOREP_SUPPORT False)
  endif()

  set(LIT_SITE_CFG_IN_HEADER "## Autogenerated from ${input}\n## Do not edit!")

  configure_file(${input} ${output} @ONLY)
endfunction()

configure_lit_site_cfg(
    ${CMAKE_CURRENT_SOURCE_DIR}/lit.site.cfg.in
    ${CMAKE_CURRENT_BINARY_DIR}/lit.site.cfg
)

add_lit_testsuite(capi-xray-test
    "Running the CaPI XRay tests"
    ${CMAKE_CURRENT_SOURCE_DIR}
    ARGS -v -j 1
    PARAMS site_config=${CMAKE_CURRENT_BINARY_DIR}/lit.site.cfg
    DEPENDS dyncapi
    )

add_test(
    NAME ctest_lit_suite COMMAND
    ${LIT_COMMAND_I} -j 1 --param site_config=${CMAKE_CURRENT_BINARY_DIR}/lit.site.cfg ${CMAKE_CURRENT_SOURCE_DIR}
)

